{% extends "base.html" %}

{% block title %}Book Resource - Campus Resource Hub{% endblock %}

{% block extra_css %}
<style>
    body {
        background-color: var(--iu-light);
    }

    /* Container */
    .booking-form-container {
        max-width: 1000px;
        margin: 0 auto;
        padding: var(--space-2xl) var(--space-md);
    }

    /* Breadcrumb */
    .page-breadcrumb {
        display: flex;
        align-items: center;
        gap: var(--space-xs);
        margin-bottom: var(--space-lg);
        padding: var(--space-sm) var(--space-md);
        font-size: var(--font-size-xs);
        font-weight: 600;
        color: var(--neutral-gray-900);
        text-transform: uppercase;
        letter-spacing: 0.5px;
        background: var(--neutral-white);
        border-radius: var(--radius-2xl);
        border: 1px solid var(--neutral-gray-300);
        width: fit-content;
    }

    .page-breadcrumb a {
        color: var(--neutral-gray-900);
        text-decoration: none;
        transition: color var(--transition-fast);
        padding: var(--space-xs) var(--space-sm);
        border-radius: var(--radius-sm);
    }

    .page-breadcrumb a:hover {
        color: var(--iu-crimson);
        background-color: var(--iu-light);
    }

    .page-breadcrumb .breadcrumb-separator {
        color: var(--neutral-gray-600);
        font-weight: 400;
    }

    .page-breadcrumb span:last-child {
        color: var(--iu-crimson);
        font-weight: 700;
    }

    /* Resource Summary Card */
    .resource-summary {
        background: linear-gradient(135deg, var(--iu-crimson) 0%, var(--iu-dark) 100%);
        color: var(--neutral-white);
        padding: var(--space-2xl);
        border-radius: var(--radius-2xl);
        margin-bottom: var(--space-xl);
        box-shadow: var(--shadow-lg);
    }

    .resource-summary h1 {
        margin: 0 0 var(--space-md) 0;
        font-size: var(--font-size-3xl);
        font-weight: 700;
        color: var(--neutral-white);
    }

    .resource-summary p {
        margin: 0 0 var(--space-lg) 0;
        font-size: var(--font-size-base);
        line-height: var(--line-height-relaxed);
        opacity: 0.95;
    }

    .resource-meta {
        display: flex;
        flex-wrap: wrap;
        gap: var(--space-lg);
        margin-top: var(--space-lg);
    }

    .meta-item {
        display: flex;
        align-items: center;
        gap: var(--space-sm);
        font-size: var(--font-size-sm);
        font-weight: 500;
    }

    .meta-icon {
        font-size: var(--font-size-lg);
    }

    /* Form Card */
    .booking-form-card {
        background: var(--neutral-white);
        border-radius: var(--radius-xl);
        padding: var(--space-2xl);
        box-shadow: var(--shadow-md);
        border: 1px solid var(--neutral-gray-200);
    }

    .booking-form-card h2 {
        color: var(--iu-crimson);
        margin: 0 0 var(--space-sm) 0;
        font-size: var(--font-size-2xl);
        font-weight: 700;
    }

    .booking-form-card > .subtitle {
        color: var(--neutral-gray-600);
        margin: 0 0 var(--space-xl) 0;
        font-size: var(--font-size-sm);
        line-height: var(--line-height-relaxed);
    }

    /* Form Layout */
    .datetime-row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: var(--space-lg);
        margin-bottom: var(--space-lg);
    }

    .form-group label {
        display: block;
        margin-bottom: var(--space-sm);
        font-weight: 600;
        color: var(--iu-dark);
        font-size: var(--font-size-sm);
    }

    .label-required {
        color: var(--error);
        margin-left: 2px;
    }

    .help-text {
        font-size: var(--font-size-xs);
        color: var(--neutral-gray-600);
        margin-top: var(--space-xs);
        line-height: var(--line-height-normal);
    }

    /* Datetime Group */
    .datetime-group {
        display: flex;
        flex-direction: column;
        gap: var(--space-sm);
    }

    /* Recurring Checkbox */
    .recurring-checkbox-wrapper {
        margin: var(--space-xl) 0;
        padding: var(--space-lg);
        background: var(--iu-light);
        border-radius: var(--radius-lg);
        border: 1px solid var(--neutral-gray-200);
    }

    .recurring-checkbox-label {
        display: flex;
        align-items: center;
        gap: var(--space-md);
        cursor: pointer;
        font-weight: 500;
        color: var(--iu-dark);
    }

    .recurring-checkbox-label input[type="checkbox"] {
        width: 20px;
        height: 20px;
        cursor: pointer;
        accent-color: var(--iu-crimson);
    }

    /* Recurring Options */
    #recurringOptions {
        background: var(--neutral-white);
        padding: var(--space-xl);
        border-radius: var(--radius-lg);
        border: 2px solid var(--iu-crimson);
        margin-top: var(--space-lg);
    }

    #recurringOptions h3 {
        margin: 0 0 var(--space-lg) 0;
        color: var(--iu-crimson);
        font-size: var(--font-size-lg);
        font-weight: 700;
    }

    #recurringPreview {
        background: var(--iu-light);
        padding: var(--space-lg);
        border-radius: var(--radius-md);
        border: 1px solid var(--neutral-gray-200);
        margin-top: var(--space-lg);
    }

    #recurringPreview strong {
        color: var(--iu-crimson);
        font-size: var(--font-size-sm);
        font-weight: 700;
        display: block;
        margin-bottom: var(--space-sm);
    }

    #recurringPreviewText {
        color: var(--neutral-gray-700);
        font-size: var(--font-size-sm);
        line-height: var(--line-height-relaxed);
    }

    /* Messages */
    .error-message,
    .success-message {
        padding: var(--space-md) var(--space-lg);
        border-radius: var(--radius-md);
        margin-bottom: var(--space-lg);
        display: none;
        font-size: var(--font-size-sm);
        font-weight: 500;
        border-left: 4px solid;
        animation: slideIn var(--transition-base);
    }

    .error-message {
        background-color: var(--error-light);
        color: var(--error);
        border-left-color: var(--error);
    }

    .success-message {
        background-color: var(--success-light);
        color: var(--success);
        border-left-color: var(--success);
    }

    /* Form Actions */
    .form-actions {
        display: flex;
        gap: var(--space-md);
        margin-top: var(--space-2xl);
        padding-top: var(--space-xl);
        border-top: 1px solid var(--neutral-gray-200);
    }

    .form-actions .btn {
        flex: 1;
        font-size: var(--font-size-base);
        padding: var(--space-md) var(--space-xl);
        justify-content: center;
    }

    /* Loading Overlay */
    .loading-overlay {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.6);
        display: none;
        align-items: center;
        justify-content: center;
        z-index: var(--z-modal);
        backdrop-filter: blur(4px);
    }

    .loading-overlay.active {
        display: flex;
        animation: fadeIn var(--transition-base);
    }

    @keyframes fadeIn {
        from { opacity: 0; }
        to { opacity: 1; }
    }

    .loading-spinner {
        background: var(--neutral-white);
        padding: var(--space-2xl);
        border-radius: var(--radius-xl);
        text-align: center;
        box-shadow: var(--shadow-xl);
    }

    .loading-spinner p {
        color: var(--iu-dark);
        font-size: var(--font-size-base);
        font-weight: 600;
        margin: 0;
    }

    .spinner {
        width: 50px;
        height: 50px;
        border: 4px solid var(--neutral-gray-200);
        border-top: 4px solid var(--iu-crimson);
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin: 0 auto var(--space-lg);
    }

    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }

    /* Responsive Design */
    @media (max-width: 768px) {
        .booking-form-container {
            padding: var(--space-xl) var(--space-md);
        }

        .booking-form-card {
            padding: var(--space-xl);
        }

        .resource-summary {
            padding: var(--space-xl);
        }

        .resource-summary h1 {
            font-size: var(--font-size-2xl);
        }

        .datetime-row {
            grid-template-columns: 1fr;
        }

        .form-actions {
            flex-direction: column;
        }

        .resource-meta {
            flex-direction: column;
            gap: var(--space-md);
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="booking-form-container">
    <!-- Breadcrumb -->
    <div class="page-breadcrumb">
        <a href="{{ url_for('resources.list_resources') }}">Resources</a>
        <span class="breadcrumb-separator">‚Ä∫</span>
        <a href="{{ url_for('resources.detail_resource', resource_id=resource.id) }}">{{ resource.name }}</a>
        <span class="breadcrumb-separator">‚Ä∫</span>
        <span>New Booking</span>
    </div>

    <!-- Resource Summary -->
    <div class="resource-summary">
        <h1>{{ resource.name }}</h1>
        <p>{{ resource.description }}</p>
        <div class="resource-meta">
            <div class="meta-item">
                <span class="meta-icon">üìç</span>
                <span>{{ resource.location }}</span>
            </div>
            <div class="meta-item">
                <span class="meta-icon">üè∑Ô∏è</span>
                <span>{{ resource.resource_type }}</span>
            </div>
            {% if resource.capacity %}
            <div class="meta-item">
                <span class="meta-icon">üë•</span>
                <span>Capacity: {{ resource.capacity }}</span>
            </div>
            {% endif %}
        </div>
    </div>

    <!-- Booking Form -->
    <div class="booking-form-card">
        <h2>Complete Your Booking</h2>
        <p class="subtitle">Fill in the details below to reserve this resource</p>

        <div class="error-message" id="errorMessage"></div>
        <div class="success-message" id="successMessage"></div>

        <form id="bookingForm">
            <input type="hidden" name="resource_id" value="{{ resource.id }}">

            <div class="datetime-row">
                <!-- Start Date/Time -->
                <div class="form-group">
                    <label>
                        Start Date & Time <span class="label-required">*</span>
                    </label>
                    <div class="datetime-group">
                        <input 
                            type="date" 
                            id="startDate" 
                            name="start_date" 
                            required
                            min="{{ today }}"
                        >
                        <input 
                            type="time" 
                            id="startTime" 
                            name="start_time" 
                            required
                        >
                    </div>
                    <div class="help-text">When do you need the resource?</div>
                </div>

                <!-- End Date/Time -->
                <div class="form-group">
                    <label>
                        End Date & Time <span class="label-required">*</span>
                    </label>
                    <div class="datetime-group">
                        <input 
                            type="date" 
                            id="endDate" 
                            name="end_date" 
                            required
                            min="{{ today }}"
                        >
                        <input 
                            type="time" 
                            id="endTime" 
                            name="end_time" 
                            required
                        >
                    </div>
                    <div class="help-text">When will you be finished?</div>
                </div>
            </div>

            <!-- Notes -->
            <div class="form-group">
                <label>Additional Notes</label>
                <textarea 
                    id="notes" 
                    name="notes" 
                    placeholder="Add any special requirements or notes about your booking..."
                ></textarea>
                <div class="help-text">Include setup requirements, equipment needs, or special considerations (optional)</div>
            </div>

            <!-- Recurring Booking -->
            <div class="recurring-checkbox-wrapper">
                <label class="recurring-checkbox-label">
                    <input 
                        type="checkbox" 
                        id="isRecurring" 
                        name="is_recurring"
                    >
                    <span>Make this a recurring booking</span>
                </label>
                <div class="help-text" style="margin-left: 34px;">
                    ‚ö†Ô∏è Recurring bookings require admin approval, even if the resource normally auto-approves.
                </div>
            </div>

            <!-- Recurring Options (hidden by default) -->
            <div id="recurringOptions" style="display: none;">
                <h3>Recurring Booking Options</h3>
                
                <div class="form-group">
                    <label>
                        Repeat Pattern <span class="label-required">*</span>
                    </label>
                    <select 
                        id="recurrencePattern" 
                        name="recurrence_pattern"
                    >
                        <option value="weekly">Weekly (every week on this day)</option>
                        <option value="biweekly">Bi-weekly (every 2 weeks on this day)</option>
                        <option value="daily">Daily (every weekday)</option>
                        <option value="monthly">Monthly (same day each month)</option>
                    </select>
                    <div class="help-text">How often should this booking repeat?</div>
                </div>

                <div class="form-group">
                    <label>
                        Repeat Until <span class="label-required">*</span>
                    </label>
                    <input 
                        type="date" 
                        id="recurrenceEndDate" 
                        name="recurrence_end_date"
                        min="{{ today }}"
                    >
                    <div class="help-text">When should the recurring bookings stop?</div>
                </div>

                <div id="recurringPreview">
                    <strong>Preview</strong>
                    <div id="recurringPreviewText">
                        Select dates and pattern to see preview
                    </div>
                </div>
            </div>

            <!-- Form Actions -->
            <div class="form-actions">
                <a href="{{ url_for('resources.detail_resource', resource_id=resource.id) }}" class="btn btn-secondary">
                    Cancel
                </a>
                <button type="submit" class="btn btn-primary" id="submitBtn">
                    Confirm Booking
                </button>
            </div>
        </form>
    </div>
</div>

<!-- Loading Overlay -->
<div class="loading-overlay" id="loadingOverlay">
    <div class="loading-spinner">
        <div class="spinner"></div>
        <p>Processing your booking...</p>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('bookingForm');
    const submitBtn = document.getElementById('submitBtn');
    const errorMessage = document.getElementById('errorMessage');
    const successMessage = document.getElementById('successMessage');
    const loadingOverlay = document.getElementById('loadingOverlay');

    // Set default times (current time rounded to next hour)
    const now = new Date();
    const startTime = new Date(now.getTime() + 60 * 60 * 1000); // 1 hour from now
    startTime.setMinutes(0);
    const endTime = new Date(startTime.getTime() + 2 * 60 * 60 * 1000); // 2 hours duration

    document.getElementById('startDate').valueAsDate = startTime;
    document.getElementById('startTime').value = startTime.toTimeString().slice(0, 5);
    document.getElementById('endDate').valueAsDate = endTime;
    document.getElementById('endTime').value = endTime.toTimeString().slice(0, 5);

    // Form validation
    function validateForm() {
        const startDate = document.getElementById('startDate').value;
        const startTime = document.getElementById('startTime').value;
        const endDate = document.getElementById('endDate').value;
        const endTime = document.getElementById('endTime').value;

        if (!startDate || !startTime || !endDate || !endTime) {
            showError('Please fill in all date and time fields.');
            return false;
        }

        const start = new Date(`${startDate}T${startTime}`);
        const end = new Date(`${endDate}T${endTime}`);

        if (start >= end) {
            showError('End time must be after start time.');
            return false;
        }

        if (start < new Date()) {
            showError('Start time cannot be in the past.');
            return false;
        }

        return true;
    }

    // Form submission
    form.addEventListener('submit', async function(e) {
        e.preventDefault();

        if (!validateForm()) {
            return;
        }

        // Hide messages
        errorMessage.style.display = 'none';
        successMessage.style.display = 'none';

        // Show loading
        loadingOverlay.classList.add('active');
        submitBtn.disabled = true;

        // Prepare data
        const startDate = document.getElementById('startDate').value;
        const startTime = document.getElementById('startTime').value;
        const endDate = document.getElementById('endDate').value;
        const endTime = document.getElementById('endTime').value;
        const notes = document.getElementById('notes').value;
        const resourceId = {{ resource.id }};
        const isRecurring = document.getElementById('isRecurring').checked;

        const data = {
            resource_id: resourceId,
            start_datetime: `${startDate} ${startTime}:00`,
            end_datetime: `${endDate} ${endTime}:00`,
            notes: notes,
            is_recurring: isRecurring
        };

        // Add recurring booking data if applicable
        if (isRecurring) {
            const recurrencePattern = document.getElementById('recurrencePattern').value;
            const recurrenceEndDate = document.getElementById('recurrenceEndDate').value;
            
            if (!recurrenceEndDate) {
                showError('Please select an end date for recurring bookings.');
                submitBtn.disabled = false;
                return;
            }

            data.recurrence_pattern = recurrencePattern;
            data.recurrence_end_date = recurrenceEndDate;
        }

        try {
            const response = await fetch('{{ url_for("bookings.create_booking") }}', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(data)
            });

            const result = await response.json();

            loadingOverlay.classList.remove('active');
            submitBtn.disabled = false;

            if (response.ok && result.success) {
                // Show special message for recurring bookings
                if (result.is_recurring) {
                    showRecurringSuccessModal(
                        result.total_created,
                        result.conflicts_skipped,
                        result.booking_id
                    );
                } else {
                    // Redirect to confirmation page for single bookings
                    window.location.href = `{{ url_for('bookings.confirmation_page', booking_id=0) }}`.replace('/0', `/${result.booking_id}`);
                }
            } else {
                showError(result.error || 'Failed to create booking. Please try again.');
            }
        } catch (error) {
            loadingOverlay.classList.remove('active');
            submitBtn.disabled = false;
            showError('Network error. Please check your connection and try again.');
            console.error('Booking error:', error);
        }
    });

    // Auto-update end date when start date changes
    document.getElementById('startDate').addEventListener('change', function() {
        const endDateInput = document.getElementById('endDate');
        if (!endDateInput.value || new Date(endDateInput.value) < new Date(this.value)) {
            endDateInput.value = this.value;
        }
        updateRecurringPreview();
    });

    // Recurring booking toggle
    const isRecurringCheckbox = document.getElementById('isRecurring');
    const recurringOptions = document.getElementById('recurringOptions');
    const recurrencePattern = document.getElementById('recurrencePattern');
    const recurrenceEndDate = document.getElementById('recurrenceEndDate');

    isRecurringCheckbox.addEventListener('change', function() {
        if (this.checked) {
            recurringOptions.style.display = 'block';
            recurrenceEndDate.required = true;
            
            // Set default end date to 3 months from start date
            const startDate = new Date(document.getElementById('startDate').value);
            const defaultEnd = new Date(startDate);
            defaultEnd.setMonth(defaultEnd.getMonth() + 3);
            recurrenceEndDate.value = defaultEnd.toISOString().split('T')[0];
            
            updateRecurringPreview();
        } else {
            recurringOptions.style.display = 'none';
            recurrenceEndDate.required = false;
        }
    });

    // Update preview when options change
    recurrencePattern.addEventListener('change', updateRecurringPreview);
    recurrenceEndDate.addEventListener('change', updateRecurringPreview);
    document.getElementById('startTime').addEventListener('change', updateRecurringPreview);
    document.getElementById('endTime').addEventListener('change', updateRecurringPreview);

    function updateRecurringPreview() {
        if (!isRecurringCheckbox.checked) return;

        const startDate = document.getElementById('startDate').value;
        const startTime = document.getElementById('startTime').value;
        const endTime = document.getElementById('endTime').value;
        const pattern = recurrencePattern.value;
        const endDate = recurrenceEndDate.value;

        if (!startDate || !endDate || !startTime || !endTime) {
            document.getElementById('recurringPreviewText').textContent = 'Select all dates and times to see preview';
            return;
        }

        const start = new Date(startDate);
        const end = new Date(endDate);
        const dayOfWeek = start.toLocaleDateString('en-US', { weekday: 'long' });
        
        // Calculate approximate number of occurrences
        const daysDiff = Math.floor((end - start) / (1000 * 60 * 60 * 24));
        let occurrences = 0;
        
        switch(pattern) {
            case 'daily':
                occurrences = Math.floor(daysDiff / 1) + 1;
                break;
            case 'weekly':
                occurrences = Math.floor(daysDiff / 7) + 1;
                break;
            case 'biweekly':
                occurrences = Math.floor(daysDiff / 14) + 1;
                break;
            case 'monthly':
                occurrences = Math.floor(daysDiff / 30) + 1;
                break;
        }

        let previewText = '';
        const patternText = {
            'daily': 'every weekday',
            'weekly': `every ${dayOfWeek}`,
            'biweekly': `every other ${dayOfWeek}`,
            'monthly': `on day ${start.getDate()} of each month`
        };

        previewText = `This will create approximately <strong>${occurrences} bookings</strong> `;
        previewText += `${patternText[pattern]}, `;
        previewText += `from <strong>${startTime}</strong> to <strong>${endTime}</strong>, `;
        previewText += `starting ${start.toLocaleDateString()} and ending ${end.toLocaleDateString()}.`;
        previewText += `<br><br><em style="color: #990000;">‚ö†Ô∏è All recurring bookings require admin approval before they become active.</em>`;

        document.getElementById('recurringPreviewText').innerHTML = previewText;
    }

    // Helper functions
    function showError(message) {
        errorMessage.textContent = message;
        errorMessage.style.display = 'block';
        errorMessage.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
    }

    function showSuccess(message) {
        successMessage.textContent = message;
        successMessage.style.display = 'block';
        successMessage.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
    }
});

// Global functions for modal (outside DOMContentLoaded so onclick can access them)
function showRecurringSuccessModal(totalCreated, conflictsSkipped, bookingId) {
    const modal = document.getElementById('recurringSuccessModal');
    const totalCreatedSpan = document.getElementById('totalCreated');
    const conflictsWarning = document.getElementById('conflictsWarning');
    
    totalCreatedSpan.textContent = totalCreated;
    
    if (conflictsSkipped > 0) {
        conflictsWarning.style.display = 'block';
        document.getElementById('conflictsSkipped').textContent = conflictsSkipped;
    } else {
        conflictsWarning.style.display = 'none';
    }
    
    modal.style.display = 'flex';
    
    // Store booking ID for redirect
    window.recurringBookingId = bookingId;
}

function closeRecurringSuccessModal() {
    const modal = document.getElementById('recurringSuccessModal');
    modal.style.display = 'none';
    
    // Redirect to confirmation page
    if (window.recurringBookingId) {
        window.location.href = `{{ url_for('bookings.confirmation_page', booking_id=0) }}`.replace('/0', `/${window.recurringBookingId}`);
    }
}
</script>

<!-- Recurring Success Modal -->
<div id="recurringSuccessModal" class="success-modal" onclick="handleModalBackdropClick(event)">
    <div class="success-modal-content" onclick="event.stopPropagation()">
        <div class="success-modal-header">
            <h2>‚úÖ Recurring Booking Submitted!</h2>
            <button class="success-modal-close" onclick="closeRecurringSuccessModal()">&times;</button>
        </div>
        <div class="success-modal-body">
            <div class="success-icon">üéâ</div>
            <p class="success-main">
                Successfully created <strong id="totalCreated"></strong> booking instances!
            </p>
            <div id="conflictsWarning" class="conflicts-warning" style="display: none;">
                <p>‚ö†Ô∏è <strong id="conflictsSkipped"></strong> dates were skipped due to scheduling conflicts.</p>
            </div>
            <div class="approval-notice">
                <p>üìã All recurring bookings require admin approval.</p>
                <p>You'll be notified once they are reviewed.</p>
            </div>
        </div>
        <div class="success-modal-footer">
            <button class="btn btn-primary" onclick="closeRecurringSuccessModal()">
                View Booking Details
            </button>
        </div>
    </div>
</div>

<script>
// Handle clicking outside modal to close it
function handleModalBackdropClick(event) {
    if (event.target.id === 'recurringSuccessModal') {
        closeRecurringSuccessModal();
    }
}

// Also allow ESC key to close modal
document.addEventListener('keydown', function(event) {
    if (event.key === 'Escape') {
        const modal = document.getElementById('recurringSuccessModal');
        if (modal && modal.style.display === 'flex') {
            closeRecurringSuccessModal();
        }
    }
});
</script>

<style>
    .success-modal {
        display: none;
        position: fixed;
        z-index: 1000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.6);
        backdrop-filter: blur(4px);
        align-items: center;
        justify-content: center;
        animation: fadeIn 0.2s ease;
    }

    @keyframes fadeIn {
        from { opacity: 0; }
        to { opacity: 1; }
    }

    .success-modal-content {
        background: var(--neutral-white);
        border-radius: var(--radius-xl);
        box-shadow: var(--shadow-2xl);
        max-width: 550px;
        width: 90%;
        animation: slideUp 0.3s ease;
        border-top: 4px solid var(--success-green, #22c55e);
    }

    @keyframes slideUp {
        from {
            transform: translateY(50px);
            opacity: 0;
        }
        to {
            transform: translateY(0);
            opacity: 1;
        }
    }

    .success-modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: var(--space-xl);
        border-bottom: 1px solid var(--neutral-gray-200);
    }

    .success-modal-header h2 {
        color: var(--iu-dark);
        font-size: var(--font-size-xl);
        margin: 0;
        display: flex;
        align-items: center;
        gap: var(--space-sm);
    }

    .success-modal-close {
        background: none;
        border: none;
        font-size: 32px;
        color: var(--neutral-gray-500);
        cursor: pointer;
        transition: color var(--transition-fast);
        line-height: 1;
        padding: 0;
        width: 32px;
        height: 32px;
    }

    .success-modal-close:hover {
        color: var(--iu-crimson);
    }

    .success-modal-body {
        padding: var(--space-xl);
        text-align: center;
    }

    .success-icon {
        font-size: 72px;
        margin-bottom: var(--space-lg);
        animation: bounce 0.6s ease;
    }

    @keyframes bounce {
        0%, 100% { transform: translateY(0); }
        50% { transform: translateY(-20px); }
    }

    .success-main {
        color: var(--neutral-gray-900);
        font-size: var(--font-size-lg);
        margin-bottom: var(--space-lg);
        line-height: 1.6;
    }

    .success-main strong {
        color: var(--success-green, #22c55e);
        font-weight: 700;
        font-size: var(--font-size-2xl);
    }

    .conflicts-warning {
        background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
        border: 1px solid #fbbf24;
        border-radius: var(--radius-lg);
        padding: var(--space-md);
        margin: var(--space-lg) 0;
    }

    .conflicts-warning p {
        color: #92400e;
        font-size: var(--font-size-md);
        margin: 0;
    }

    .conflicts-warning strong {
        color: #78350f;
        font-weight: 700;
    }

    .approval-notice {
        background: linear-gradient(135deg, var(--iu-light) 0%, #fef2f2 100%);
        border: 1px solid var(--iu-crimson-light, #fca5a5);
        border-radius: var(--radius-lg);
        padding: var(--space-lg);
        margin-top: var(--space-lg);
    }

    .approval-notice p {
        color: var(--neutral-gray-700);
        font-size: var(--font-size-md);
        margin: var(--space-xs) 0;
        line-height: 1.5;
    }

    .approval-notice p:first-child {
        font-weight: 600;
        color: var(--iu-crimson);
    }

    .success-modal-footer {
        padding: var(--space-xl);
        border-top: 1px solid var(--neutral-gray-200);
        display: flex;
        justify-content: center;
        gap: var(--space-md);
    }

    .success-modal-footer .btn {
        min-width: 200px;
        font-size: var(--font-size-md);
        padding: var(--space-md) var(--space-xl);
    }

    @media (max-width: 768px) {
        .success-modal-content {
            width: 95%;
            margin: var(--space-md);
        }

        .success-icon {
            font-size: 56px;
        }

        .success-main {
            font-size: var(--font-size-md);
        }

        .success-modal-footer .btn {
            min-width: auto;
            width: 100%;
        }
    }
</style>

{% endblock %}
