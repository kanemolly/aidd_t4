{% extends "base.html" %}

{% block title %}{{ resource.name }} - Campus Resource Hub{% endblock %}

{% block extra_css %}
        body {
            background-color: #f8f7f5;
        }

        .resource-detail-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: var(--space-2xl);
        }

        /* Report Modal Styles */
        .report-modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.3s ease;
        }

        .report-modal-overlay.active {
            display: flex;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideUp {
            from { 
                transform: translateY(30px);
                opacity: 0;
            }
            to { 
                transform: translateY(0);
                opacity: 1;
            }
        }

        .report-modal {
            background: white;
            border-radius: var(--radius-xl);
            padding: var(--space-2xl);
            max-width: 500px;
            width: 90%;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            animation: slideUp 0.3s ease;
        }

        .report-modal h2 {
            color: var(--iu-crimson);
            margin: 0 0 var(--space-md) 0;
            font-size: 24px;
        }

        .report-modal p {
            color: #666;
            margin: 0 0 var(--space-lg) 0;
            font-size: 14px;
            line-height: 1.5;
        }

        .report-modal textarea {
            width: 100%;
            min-height: 120px;
            padding: var(--space-md);
            border: 2px solid #e0e0e0;
            border-radius: var(--radius-md);
            font-family: inherit;
            font-size: 14px;
            resize: vertical;
            box-sizing: border-box;
            transition: border-color 0.3s ease;
        }

        .report-modal textarea:focus {
            outline: none;
            border-color: var(--iu-crimson);
        }

        .report-modal-actions {
            display: flex;
            gap: var(--space-md);
            margin-top: var(--space-xl);
            justify-content: flex-end;
        }

        .report-modal button {
            padding: 10px 20px;
            border: none;
            border-radius: var(--radius-md);
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .report-modal .btn-cancel {
            background: #f0f0f0;
            color: #333;
        }

        .report-modal .btn-cancel:hover {
            background: #e0e0e0;
        }

        .report-modal .btn-submit {
            background: var(--iu-crimson);
            color: white;
        }

        .report-modal .btn-submit:hover:not(:disabled) {
            background: #8b2635;
        }

        .report-modal .btn-submit:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Review Success Modal Styles */
        .review-success-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            z-index: 1001;
            align-items: center;
            justify-content: center;
        }

        .review-success-modal.active {
            display: flex;
        }

        .review-success-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            cursor: pointer;
        }

        .review-success-content {
            position: relative;
            background: white;
            border-radius: var(--radius-2xl);
            padding: 60px 40px;
            max-width: 420px;
            width: 90%;
            text-align: center;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.2);
            animation: slideUp 0.4s ease-out;
        }

        .review-success-icon {
            font-size: 64px;
            margin-bottom: var(--space-lg);
            animation: scaleIn 0.5s ease-out;
        }

        @keyframes scaleIn {
            from {
                transform: scale(0);
                opacity: 0;
            }
            to {
                transform: scale(1);
                opacity: 1;
            }
        }

        .review-success-content h2 {
            color: var(--iu-crimson);
            font-size: 28px;
            margin: 0 0 var(--space-md) 0;
            font-weight: 700;
        }

        .review-success-content > p {
            color: #333;
            font-size: 16px;
            margin: 0 0 var(--space-lg) 0;
            font-weight: 500;
        }

        .review-success-message {
            background: #f0f8ff;
            border-left: 4px solid var(--iu-crimson);
            padding: var(--space-md) var(--space-lg);
            border-radius: var(--radius-md);
            margin-bottom: var(--space-xl);
            text-align: left;
        }

        .review-success-message p {
            margin: 0;
            color: #555;
            font-size: 14px;
            line-height: 1.6;
        }

        .btn-success {
            background: linear-gradient(135deg, var(--iu-crimson) 0%, #8b2635 100%);
            color: white;
            padding: 12px 32px;
            border: none;
            border-radius: var(--radius-lg);
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 150px;
        }

        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(153, 0, 0, 0.3);
        }

        /* Message Modal Styles */
        .message-modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1001;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.3s ease;
        }

        .message-modal-overlay.active {
            display: flex;
        }

        .message-modal {
            background: white;
            border-radius: var(--radius-xl);
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            max-width: 500px;
            width: 90%;
            display: flex;
            flex-direction: column;
            max-height: 80vh;
            animation: slideUp 0.3s ease;
        }

        .message-modal-header {
            padding: var(--space-lg);
            border-bottom: 1px solid #f0f0f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .message-modal-header h2 {
            margin: 0;
            color: var(--iu-crimson);
            font-size: 20px;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 24px;
            color: #999;
            cursor: pointer;
            padding: 0;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 4px;
            transition: all 0.2s ease;
        }

        .close-btn:hover {
            background-color: #f0f0f0;
            color: #333;
        }

        .message-modal-body {
            padding: var(--space-lg);
            overflow-y: auto;
            flex: 1;
        }

        .recipient-info {
            display: flex;
            gap: var(--space-md);
            margin-bottom: var(--space-xl);
            padding: var(--space-md);
            background: #f9f9f9;
            border-radius: var(--radius-md);
            align-items: center;
        }

        .recipient-avatar {
            width: 48px;
            height: 48px;
            min-width: 48px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--iu-crimson), #cc0000);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 18px;
        }

        .recipient-name {
            font-weight: 600;
            color: #333;
            font-size: 14px;
        }

        .recipient-resource {
            color: #999;
            font-size: 12px;
            margin-top: 2px;
        }

        .form-group {
            margin-bottom: var(--space-lg);
        }

        .form-group label {
            display: block;
            margin-bottom: var(--space-sm);
            font-weight: 600;
            color: #333;
            font-size: 14px;
        }

        .form-group textarea {
            width: 100%;
            padding: var(--space-md);
            border: 2px solid #e0e0e0;
            border-radius: var(--radius-md);
            font-family: inherit;
            font-size: 14px;
            resize: vertical;
            box-sizing: border-box;
            transition: all 0.2s ease;
        }

        .form-group textarea:focus {
            outline: none;
            border-color: var(--iu-crimson);
            box-shadow: 0 0 0 3px rgba(153, 0, 0, 0.1);
        }

        .char-count {
            font-size: 12px;
            color: #999;
            margin-top: 4px;
            text-align: right;
        }

        .message-modal-footer {
            padding: var(--space-lg);
            border-top: 1px solid #f0f0f0;
            display: flex;
            gap: var(--space-md);
            justify-content: flex-end;
        }

        .btn-cancel, .btn-send {
            padding: 10px 20px;
            border: none;
            border-radius: var(--radius-md);
            font-weight: 600;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .btn-cancel {
            background-color: #f0f0f0;
            color: #333;
        }

        .btn-cancel:hover {
            background-color: #e0e0e0;
        }

        .btn-send {
            background: linear-gradient(135deg, var(--iu-crimson) 0%, #8b2635 100%);
            color: white;
            min-width: 120px;
        }

        .btn-send:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(153, 0, 0, 0.3);
        }

        .btn-send:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .message-status {
            padding: 0 var(--space-lg) var(--space-sm);
            font-size: 13px;
            min-height: 16px;
            text-align: center;
        }

        .message-status.success {
            color: #28a745;
        }

        .message-status.error {
            color: #dc3545;
        }

        /* Breadcrumb */
        .breadcrumb {
            display: flex;
            gap: 8px;
            margin-bottom: var(--space-lg);
            font-size: 14px;
            color: #666;
        }

        .breadcrumb a {
            color: var(--iu-crimson);
            text-decoration: none;
            font-weight: 500;
        }

        .breadcrumb a:hover {
            text-decoration: underline;
        }

        /* Main Grid: 3-column layout for large screens */
        .detail-grid {
            display: grid;
            grid-template-columns: 1fr 1.5fr 1fr;
            gap: var(--space-2xl);
            margin-bottom: var(--space-3xl);
        }

        /* LEFT COLUMN: Image + Quick Details */
        .left-column {
            display: flex;
            flex-direction: column;
            gap: var(--space-xl);
        }

        .resource-image-section {
            background: white;
            border-radius: var(--radius-xl);
            overflow: hidden;
            box-shadow: var(--shadow-md);
            aspect-ratio: 4/3;
        }

        .resource-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            background: linear-gradient(135deg, #f5f5f5 0%, #e8e8e8 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: #999;
            font-size: 14px;
        }

        /* Quick Details Card */
        .quick-details {
            background: white;
            border-radius: var(--radius-xl);
            padding: var(--space-lg);
            box-shadow: var(--shadow-md);
        }

        .quick-details h3 {
            color: var(--iu-crimson);
            font-size: var(--font-size-sm);
            text-transform: uppercase;
            font-weight: 700;
            margin: 0 0 var(--space-md) 0;
            letter-spacing: 0.5px;
        }

        .detail-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--space-sm) 0;
            border-bottom: 1px solid #eee;
        }

        .detail-row:last-child {
            border-bottom: none;
        }

        .detail-label {
            font-weight: 600;
            color: #666;
            font-size: 13px;
            text-transform: uppercase;
        }

        .detail-value {
            color: #333;
            font-weight: 500;
            font-size: 15px;
        }

        .status-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .status-available {
            background-color: #d4edda;
            color: #155724;
        }

        .status-unavailable {
            background-color: #f8d7da;
            color: #721c24;
        }

        /* Action Buttons */
        .action-buttons {
            display: flex;
            gap: var(--space-md);
            flex-direction: column;
        }

        .btn-primary, .btn-secondary {
            padding: var(--space-md) var(--space-lg);
            border: none;
            border-radius: var(--radius-md);
            font-weight: 600;
            font-size: 15px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            text-align: center;
            text-decoration: none;
            display: block;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--iu-crimson) 0%, #7a0000 100%);
            color: white;
            box-shadow: 0 4px 12px rgba(153, 0, 0, 0.2);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(153, 0, 0, 0.3);
        }

        .btn-secondary {
            background: #f0f0f0;
            color: #333;
            border: 1px solid #ddd;
        }

        .btn-secondary:hover {
            background: #e8e8e8;
        }

        /* RIGHT COLUMN: Main Info */
        .right-column {
            display: flex;
            flex-direction: column;
            gap: var(--space-2xl);
        }

        .resource-header {
            padding-bottom: var(--space-lg);
            border-bottom: 2px solid #eee;
        }

        .resource-type-tag {
            display: inline-block;
            background: linear-gradient(135deg, var(--iu-crimson) 0%, #7a0000 100%);
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            margin-bottom: var(--space-sm);
        }

        .resource-name {
            font-size: var(--font-size-3xl);
            font-weight: 700;
            color: var(--iu-dark);
            margin: var(--space-md) 0;
            line-height: 1.2;
        }

        .resource-location {
            display: flex;
            align-items: center;
            gap: 8px;
            color: #666;
            font-size: 15px;
            margin-bottom: var(--space-md);
        }

        .resource-location svg {
            width: 18px;
            height: 18px;
            flex-shrink: 0;
        }

        .resource-description {
            color: #555;
            font-size: 15px;
            line-height: 1.6;
            margin: var(--space-lg) 0;
        }

        /* Content Sections */
        .content-section {
            background: white;
            border-radius: var(--radius-xl);
            padding: var(--space-lg);
            box-shadow: var(--shadow-sm);
        }

        .section-title {
            font-size: var(--font-size-xl);
            font-weight: 700;
            color: var(--iu-crimson);
            margin: 0 0 var(--space-lg) 0;
            padding-bottom: var(--space-md);
            border-bottom: 2px solid #eee;
        }

        /* Reviews Section */
        .reviews-section {
            background: white;
            border-radius: var(--radius-xl);
            padding: var(--space-2xl);
            box-shadow: var(--shadow-sm);
            margin-top: var(--space-3xl);
        }

        .review-form {
            background: #f9f9f9;
            border-radius: var(--radius-md);
            padding: var(--space-lg);
            margin-bottom: var(--space-xl);
            border: 1px solid #eee;
        }

        .form-group {
            margin-bottom: var(--space-md);
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            font-weight: 600;
            color: #333;
            margin-bottom: 6px;
            font-size: 14px;
        }

        .form-group input,
        .form-group textarea {
            padding: var(--space-sm);
            border: 1px solid #ddd;
            border-radius: var(--radius-sm);
            font-size: 14px;
            font-family: inherit;
            resize: vertical;
        }

        .form-group textarea {
            min-height: 100px;
        }

        .form-group input:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--iu-crimson);
            box-shadow: 0 0 0 3px rgba(153, 0, 0, 0.1);
        }

        .rating-stars {
            display: flex;
            gap: 8px;
            margin: var(--space-sm) 0;
        }

        .star {
            font-size: 32px;
            cursor: pointer;
            color: #ddd;
            transition: all 0.2s ease;
            user-select: none;
        }

        .star:hover {
            color: #ffc107;
            transform: scale(1.1);
        }

        .btn-submit-review {
            background: linear-gradient(135deg, var(--iu-crimson) 0%, #7a0000 100%);
            color: white;
            padding: var(--space-md) var(--space-lg);
            border: none;
            border-radius: var(--radius-md);
            font-weight: 600;
            font-size: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            align-self: flex-start;
            margin-top: var(--space-sm);
        }

        .btn-submit-review:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(153, 0, 0, 0.3);
        }

        .review-item {
            padding: var(--space-lg);
            border-bottom: 1px solid #eee;
            border-radius: var(--radius-md);
            margin-bottom: var(--space-md);
            background: #fafafa;
            transition: background-color 0.2s ease;
        }

        .review-item:hover {
            background-color: #f5f5f5;
        }

        .review-item:last-child {
            border-bottom: none;
        }

        .review-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: var(--space-sm);
        }

        .review-author {
            font-weight: 600;
            color: #333;
            font-size: 15px;
        }

        .review-date {
            font-size: 13px;
            color: #999;
        }

        .review-rating {
            color: #ffc107;
            font-size: 14px;
            margin-bottom: var(--space-sm);
        }

        .review-text {
            color: #555;
            line-height: 1.6;
            font-size: 14px;
        }

        .no-reviews {
            padding: var(--space-2xl);
            text-align: center;
            color: #999;
            font-size: 15px;
            background: #f9f9f9;
            border-radius: var(--radius-md);
            border: 1px dashed #ddd;
        }
            font-size: 14px;
            font-family: inherit;
            resize: vertical;
        }

        .form-group textarea {
            min-height: 100px;
        }

        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: var(--iu-crimson);
            box-shadow: 0 0 0 3px rgba(153, 0, 0, 0.1);
        }

        .rating-stars {
            display: flex;
            gap: 8px;
            margin: var(--space-sm) 0;
        }

        .star {
            font-size: 32px;
            cursor: pointer;
            color: #ddd;
            transition: all 0.2s ease;
        }

        .star:hover,
        .star.active {
            color: #ffc107;
            transform: scale(1.1);
        }

        .btn-submit-review {
            background: linear-gradient(135deg, var(--iu-crimson) 0%, #7a0000 100%);
            color: white;
            padding: var(--space-md) var(--space-lg);
            border: none;
            border-radius: var(--radius-md);
            font-weight: 600;
            font-size: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            align-self: flex-start;
        }

        .btn-submit-review:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(153, 0, 0, 0.3);
        }

        .review-item {
            padding: var(--space-lg) 0;
            border-bottom: 1px solid #eee;
            border-left: 4px solid transparent;
            transition: all 0.2s ease;
        }

        .review-item:last-child {
            border-bottom: none;
        }

        .review-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: var(--space-sm);
        }

        .review-actions {
            display: flex;
            gap: 12px;
            margin-top: var(--space-md);
            align-items: center;
        }

        .btn-flag-review {
            background: none;
            border: 1px solid #ddd;
            color: #666;
            padding: 6px 12px;
            border-radius: 4px;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .btn-flag-review:hover {
            border-color: #ff9800;
            color: #ff9800;
            background: #fff8f5;
        }

        .btn-flag-review.flagged {
            background: #ffe0b2;
            border-color: #ff9800;
            color: #ff9800;
        }

        .flag-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .flag-modal.active {
            display: flex;
        }

        .flag-modal-content {
            background: white;
            border-radius: 8px;
            padding: var(--space-2xl);
            max-width: 400px;
            width: 90%;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
        }

        .flag-modal-header {
            font-size: 18px;
            font-weight: 700;
            color: #333;
            margin-bottom: var(--space-lg);
        }

        .flag-modal-form {
            display: flex;
            flex-direction: column;
            gap: var(--space-md);
        }

        .flag-reason-group {
            display: flex;
            flex-direction: column;
            gap: var(--space-sm);
        }

        .flag-reason-group label {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            font-size: 14px;
            color: #333;
        }

        .flag-reason-group input[type="radio"] {
            cursor: pointer;
        }

        .flag-modal-buttons {
            display: flex;
            gap: var(--space-md);
            margin-top: var(--space-xl);
        }

        .flag-modal-buttons button {
            flex: 1;
            padding: var(--space-md);
            border: none;
            border-radius: 4px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .flag-modal-buttons .btn-submit {
            background: var(--iu-crimson);
            color: white;
        }

        .flag-modal-buttons .btn-submit:hover {
            background: #7a0000;
        }

        .flag-modal-buttons .btn-cancel {
            background: #f0f0f0;
            color: #333;
        }

        .flag-modal-buttons .btn-cancel:hover {
            background: #e0e0e0;
        }

        .review-author {
            font-weight: 600;
            color: #333;
        }

        .review-date {
            font-size: 13px;
            color: #999;
        }

        .review-rating {
            color: #ffc107;
            font-size: 14px;
            margin-bottom: var(--space-sm);
        }

        .review-text {
            color: #555;
            line-height: 1.6;
            font-size: 14px;
        }

        .no-reviews {
            padding: var(--space-lg);
            text-align: center;
            color: #999;
            font-size: 15px;
        }

        .login-prompt {
            background: #f0f0f0;
            border-left: 4px solid var(--iu-crimson);
            padding: var(--space-lg);
            border-radius: var(--radius-sm);
            margin-bottom: var(--space-lg);
        }

        .login-prompt p {
            margin: 0 0 var(--space-sm) 0;
            color: #555;
        }

        .login-prompt a {
            color: var(--iu-crimson);
            font-weight: 600;
            text-decoration: none;
        }

        .login-prompt a:hover {
            text-decoration: underline;
        }

        /* Responsive */
        @media (max-width: 1200px) {
            .detail-grid {
                grid-template-columns: 1fr 1fr;
                gap: var(--space-xl);
            }
        }

        @media (max-width: 768px) {
            .detail-grid {
                grid-template-columns: 1fr;
                gap: var(--space-xl);
            }

            .resource-name {
                font-size: var(--font-size-2xl);
            }

            .action-buttons {
                flex-direction: column;
            }
        }
{% endblock %}

{% block content %}
<div class="resource-detail-container">
    <!-- Breadcrumb -->
    <div class="breadcrumb">
        <a href="{{ url_for('resources.list_resources') }}">Resources</a>
        <span>/</span>
        <span class="active">{{ resource.name }}</span>
    </div>

    <!-- Main 3-Column Grid -->
    <div class="detail-grid">
        <!-- COLUMN 1: Image + Quick Details -->
        <div>
            <!-- Image Section -->
            <div class="resource-image-section">
                <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='800' height='600'%3E%3Crect fill='%23f0f0f0' width='800' height='600'/%3E%3C/svg%3E" 
                     alt="{{ resource.name }}" 
                     class="resource-image"
                     data-resource-type="{{ resource.resource_type }}"
                     data-resource-name="{{ resource.name }}">
            </div>

            <!-- Quick Details Card -->
            <div class="quick-details">
                <h3>Quick Details</h3>
                
                <div class="detail-row">
                    <span class="detail-label">Type</span>
                    <span class="detail-value">{{ resource.resource_type|capitalize }}</span>
                </div>

                <div class="detail-row">
                    <span class="detail-label">Status</span>
                    <span class="status-badge {% if resource.is_available %}status-available{% else %}status-unavailable{% endif %}">
                        {% if resource.is_available %}Available{% else %}Unavailable{% endif %}
                    </span>
                </div>

                {% if resource.capacity and resource.resource_type not in ['equipment', 'facility'] %}
                <div class="detail-row">
                    <span class="detail-label">Capacity</span>
                    <span class="detail-value">
                        {% if resource.capacity == 1 %}
                            1 Person
                        {% else %}
                            {{ resource.capacity }} People
                        {% endif %}
                    </span>
                </div>
                {% endif %}

                <div class="detail-row">
                    <span class="detail-label">Location</span>
                    <span class="detail-value" style="text-align: right; font-size: 13px;">{{ resource.location }}</span>
                </div>
            </div>
        </div>

        <!-- COLUMN 2: Description & About (Main Content) -->
        <div>
            <!-- Resource Header -->
            <div class="resource-header">
                <span class="resource-type-tag">{{ resource.resource_type }}</span>
                <h1 class="resource-name">{{ resource.name }}</h1>
                
                <div class="resource-location">
                    <svg fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z" clip-rule="evenodd"/>
                    </svg>
                    {{ resource.location }}
                </div>
            </div>

            <!-- Description -->
            {% if resource.description %}
            <div class="content-section">
                <h2 class="section-title">About</h2>
                <p class="resource-description">{{ resource.description }}</p>
            </div>
            {% endif %}
        </div>

        <!-- COLUMN 3: Action Buttons -->
        <div>
            <!-- Action Buttons -->
            <div class="action-buttons">
                {% if current_user.is_authenticated %}
                <a href="{{ url_for('bookings.booking_form', resource_id=resource.id) }}" class="btn-primary">
                    üìÖ Book This Resource
                </a>
                <button onclick="openMessageModal({{ resource.creator_id }}, '{{ resource.creator.full_name }}', '{{ resource.name }}')" class="btn-secondary" style="background: white; border: 2px solid var(--iu-crimson); color: var(--iu-crimson); cursor: pointer;">
                    üí¨ Message Owner
                </button>
                <a href="{{ url_for('bookings.list_bookings') }}" class="btn-secondary">
                    View My Bookings
                </a>
                {% else %}
                <a href="{{ url_for('auth.login') }}" class="btn-primary">
                    Login to Book
                </a>
                <p style="text-align: center; color: #999; font-size: 13px; margin: 0;">
                    New user? <a href="{{ url_for('auth.register') }}" style="color: var(--iu-crimson); font-weight: 600;">Create account</a>
                </p>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Message Owner Modal -->
    <div id="messageModal" class="message-modal-overlay">
        <div class="message-modal">
            <div class="message-modal-header">
                <h2>Message Resource Owner</h2>
                <button onclick="closeMessageModal()" class="close-btn">‚úï</button>
            </div>
            <div class="message-modal-body">
                <div class="recipient-info">
                    <span class="recipient-avatar" id="recipientAvatar">A</span>
                    <div>
                        <div class="recipient-name" id="recipientName">Resource Owner</div>
                        <div class="recipient-resource" id="recipientResource">Resource Name</div>
                    </div>
                </div>
                <form id="messageForm">
                    <div class="form-group">
                        <label for="messageText">Your Message</label>
                        <textarea 
                            id="messageText" 
                            name="body" 
                            placeholder="Type your message here..." 
                            rows="5"
                            maxlength="5000"
                            required></textarea>
                        <div class="char-count">
                            <span id="charCount">0</span>/5000
                        </div>
                    </div>
                </form>
            </div>
            <div class="message-modal-footer">
                <button onclick="closeMessageModal()" class="btn-cancel">Cancel</button>
                <button onclick="sendResourceMessage()" class="btn-send">Send Message</button>
            </div>
            <div class="message-status" id="messageStatus"></div>
        </div>
    </div>

    <!-- Review Success Modal -->
    <div id="reviewSuccessModal" class="review-success-modal">
        <div class="review-success-overlay" onclick="closeReviewSuccessModal()"></div>
        <div class="review-success-content">
            <div class="review-success-icon">‚úì</div>
            <h2>Thank You!</h2>
            <p>Your review has been submitted successfully.</p>
            <div class="review-success-message">
                <p>We appreciate your feedback! Your review helps other students and faculty find the best resources.</p>
            </div>
            <button class="btn btn-success" onclick="closeReviewSuccessModal()">Great!</button>
        </div>
    </div>

    <!-- REVIEWS SECTION - Full Width Below -->
    <div class="reviews-section">
        <h2 class="section-title">üí¨ Reviews & Comments</h2>
        
        <!-- Login Prompt or Review Form -->
        {% if current_user.is_authenticated %}
            <!-- Review Form -->
            <div class="review-form">
                <h3 style="margin: 0 0 var(--space-lg) 0; color: #333;">Leave a Review</h3>
                <form id="review-form" method="POST" action="{{ url_for('reviews.create_review') }}">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                    <input type="hidden" name="resource_id" value="{{ resource.id }}">
                    
                    <div class="form-group">
                        <label>Rating</label>
                        <div class="rating-stars" id="rating-stars">
                            {% for i in range(1, 6) %}
                            <input type="radio" name="rating" value="{{ i }}" id="star-{{ i }}" style="display: none;">
                            <label for="star-{{ i }}" class="star" data-value="{{ i }}">‚òÖ</label>
                            {% endfor %}
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="review-title">Title (Optional)</label>
                        <input type="text" id="review-title" name="title" placeholder="e.g., Great equipment!" maxlength="255">
                    </div>

                    <div class="form-group">
                        <label for="review-comment">Your Review</label>
                        <textarea id="review-comment" name="comment" placeholder="Share your experience with this resource..." required minlength="5" maxlength="1000"></textarea>
                    </div>

                    <button type="submit" class="btn-submit-review">Submit Review</button>
                </form>
            </div>
        {% else %}
            <div class="login-prompt">
                <p><strong>Want to leave a review?</strong></p>
                <p>You need to be logged in to leave a review. <a href="{{ url_for('auth.login') }}">Login here</a> or <a href="{{ url_for('auth.register') }}">create an account</a>.</p>
            </div>
        {% endif %}

        <!-- Reviews List -->
        <div style="margin-top: var(--space-2xl);">
            <h3 style="margin-bottom: var(--space-lg); color: #333;">Reviews from Users</h3>
            
            {% if resource.reviews.count() > 0 %}
                {% for review in resource.reviews.all() %}
                <div class="review-item {% if review.is_flagged %}flagged{% endif %}" data-review-id="{{ review.id }}">
                    <div class="review-header">
                        <div>
                            <div class="review-author">{{ review.reviewer.full_name or review.reviewer.username }}</div>
                            {% if review.title %}
                            <div style="font-size: 14px; color: #555; font-weight: 500;">{{ review.title }}</div>
                            {% endif %}
                        </div>
                        <div class="review-date">{{ review.created_at.strftime('%B %d, %Y') }}</div>
                    </div>
                    <div class="review-rating">
                        {% for i in range(review.rating) %}‚≠ê{% endfor %}
                        <span style="color: #999; font-size: 13px; margin-left: 8px;">{{ review.rating }} / 5</span>
                    </div>
                    <div class="review-text">{{ review.comment }}</div>
                    {% if review.is_flagged and current_user.is_authenticated and current_user.is_admin %}
                    <div style="margin-top: var(--space-md); padding: 12px 16px; background: linear-gradient(135deg, #fff3e0 0%, #ffebee 100%); border-left: 4px solid #ff9800; border-radius: 6px; font-size: 13px; color: #e65100; font-weight: 500; display: flex; align-items: center; gap: 8px;">
                        <span style="font-size: 16px;">‚ö†Ô∏è</span>
                        <span>This review has been flagged for moderation and is pending review</span>
                    </div>
                    {% endif %}
                    <div class="review-actions">
                        {% if current_user.is_authenticated %}
                        <button type="button" class="btn-flag-review" onclick="reportReview({{ review.id }}); return false;">
                            üö© Report
                        </button>
                        {% endif %}
                    </div>
                </div>
                {% endfor %}
            {% else %}
                <div class="no-reviews">
                    <p>No reviews yet. Be the first to share your experience!</p>
                </div>
            {% endif %}
        </div>
    </div>
</div>

<!-- Load resource images script -->
<script src="{{ url_for('static', filename='js/resource-images.js') }}"></script>

<script>
// Star rating selector
document.querySelectorAll('.star').forEach(star => {
    star.addEventListener('click', function() {
        const value = this.dataset.value;
        document.getElementById(`star-${value}`).checked = true;
        
        // Update visual state
        document.querySelectorAll('.star').forEach((s, idx) => {
            if (idx + 1 <= value) {
                s.style.color = '#ffc107';
            } else {
                s.style.color = '#ddd';
            }
        });
    });
    
    // Hover effect
    star.addEventListener('mouseover', function() {
        const value = this.dataset.value;
        document.querySelectorAll('.star').forEach((s, idx) => {
            if (idx + 1 <= value) {
                s.style.opacity = '0.7';
            } else {
                s.style.opacity = '1';
            }
        });
    });
});

document.querySelector('.rating-stars').addEventListener('mouseout', function() {
    const checked = document.querySelector('input[name="rating"]:checked');
    if (checked) {
        const value = checked.value;
        document.querySelectorAll('.star').forEach((s, idx) => {
            if (idx + 1 <= value) {
                s.style.color = '#ffc107';
            } else {
                s.style.color = '#ddd';
            }
            s.style.opacity = '1';
        });
    } else {
        document.querySelectorAll('.star').forEach(s => {
            s.style.color = '#ddd';
            s.style.opacity = '1';
        });
    }
});

// Form submission
document.getElementById('review-form').addEventListener('submit', function(e) {
    e.preventDefault();
    
    const rating = document.querySelector('input[name="rating"]:checked');
    if (!rating) {
        showErrorToast('Please select a rating');
        return false;
    }
    
    const comment = document.getElementById('review-comment').value.trim();
    if (!comment || comment.length < 5) {
        showErrorToast('Please enter a review of at least 5 characters');
        return false;
    }
    
    // Prepare data as JSON
    const data = {
        resource_id: parseInt(document.querySelector('input[name="resource_id"]').value),
        rating: parseInt(rating.value),
        comment: comment,
        title: document.getElementById('review-title').value.trim() || null
    };
    
    // Submit via AJAX
    fetch('{{ url_for("reviews.create_review") }}', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': document.querySelector('input[name="csrf_token"]').value
        },
        body: JSON.stringify(data)
    })
    .then(response => response.json())
    .then(result => {
        if (result.status === 'success') {
            // Show success modal
            showReviewSuccessModal();
            
            // Reset form
            document.getElementById('review-form').reset();
            // Reset star colors
            document.querySelectorAll('.star').forEach(s => {
                s.style.color = '#ddd';
            });
            
            // Reload page after modal is closed (3 seconds)
            setTimeout(() => {
                location.reload();
            }, 3000);
        } else {
            showErrorToast('Error: ' + result.message);
        }
    })
    .catch(error => {
        console.error('Error:', error);
        showErrorToast('Error submitting review. Please try again.');
    });
});

// Review Success Modal Functions
function showReviewSuccessModal() {
    const modal = document.getElementById('reviewSuccessModal');
    if (modal) {
        modal.classList.add('active');
    }
}

function closeReviewSuccessModal() {
    const modal = document.getElementById('reviewSuccessModal');
    if (modal) {
        modal.classList.remove('active');
    }
}

// Message Modal Functions
function openMessageModal(creatorId, creatorName, resourceName) {
    const modal = document.getElementById('messageModal');
    const textarea = document.getElementById('messageText');
    const charCount = document.getElementById('charCount');
    
    // Set recipient info
    document.getElementById('recipientAvatar').textContent = creatorName[0].toUpperCase();
    document.getElementById('recipientName').textContent = creatorName;
    document.getElementById('recipientResource').textContent = 'About: ' + resourceName;
    
    // Store creator ID for later
    modal.dataset.creatorId = creatorId;
    
    // Reset form
    textarea.value = '';
    charCount.textContent = '0';
    document.getElementById('messageStatus').textContent = '';
    document.getElementById('messageStatus').className = 'message-status';
    
    // Show modal
    if (modal) {
        modal.classList.add('active');
    }
}

function closeMessageModal() {
    const modal = document.getElementById('messageModal');
    if (modal) {
        modal.classList.remove('active');
    }
}

// Message form character counter
document.addEventListener('DOMContentLoaded', function() {
    const textarea = document.getElementById('messageText');
    if (textarea) {
        textarea.addEventListener('input', function() {
            document.getElementById('charCount').textContent = this.value.length;
        });
    }
});

// Send message from modal
async function sendResourceMessage() {
    const modal = document.getElementById('messageModal');
    const textarea = document.getElementById('messageText');
    const statusDiv = document.getElementById('messageStatus');
    const sendBtn = event.target;
    const creatorId = modal.dataset.creatorId;
    const message = textarea.value.trim();
    
    // Validation
    if (!message) {
        statusDiv.textContent = '‚ùå Message cannot be empty';
        statusDiv.className = 'message-status error';
        return;
    }
    
    if (!creatorId) {
        statusDiv.textContent = '‚ùå Error: Creator ID not found';
        statusDiv.className = 'message-status error';
        return;
    }
    
    // Get CSRF token from meta tag
    const csrfToken = document.querySelector('meta[name="csrf-token"]')?.getAttribute('content') || '';
    
    // Disable button and show status
    sendBtn.disabled = true;
    statusDiv.textContent = '‚è≥ Sending message...';
    statusDiv.className = 'message-status';
    
    try {
        const response = await fetch('/messages/', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': csrfToken
            },
            body: JSON.stringify({
                recipient_id: parseInt(creatorId),
                body: message,
                subject: 'Message about a resource'
            })
        });
        
        if (response.ok) {
            const result = await response.json();
            statusDiv.textContent = '‚úì Message sent successfully!';
            statusDiv.className = 'message-status success';
            
            // Close modal after a short delay
            setTimeout(() => {
                closeMessageModal();
                showSuccessToast('Your message has been sent to the resource owner');
            }, 1000);
        } else {
            const error = await response.json();
            statusDiv.textContent = '‚ùå Failed to send: ' + (error.error || 'Unknown error');
            statusDiv.className = 'message-status error';
            sendBtn.disabled = false;
        }
    } catch (error) {
        console.error('Error sending message:', error);
        statusDiv.textContent = '‚ùå Network error. Please try again.';
        statusDiv.className = 'message-status error';
        sendBtn.disabled = false;
    }
}

// Close modal when clicking outside
document.addEventListener('click', function(e) {
    const modal = document.getElementById('messageModal');
    if (modal && e.target === modal) {
        closeMessageModal();
    }
});

// Toast Notification Functions
function showSuccessToast(message) {
    const toast = document.createElement('div');
    toast.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        color: white;
        padding: 16px 24px;
        border-radius: 8px;
        box-shadow: 0 10px 25px rgba(16, 185, 129, 0.3);
        z-index: 9999;
        font-size: 14px;
        font-weight: 500;
        max-width: 400px;
        opacity: 0;
        transform: translateX(400px);
        transition: all 0.3s ease;
    `;
    toast.textContent = message;
    document.body.appendChild(toast);
    
    setTimeout(() => {
        toast.style.opacity = '1';
        toast.style.transform = 'translateX(0)';
    }, 10);
    
    setTimeout(() => {
        toast.style.opacity = '0';
        toast.style.transform = 'translateX(400px)';
        setTimeout(() => toast.remove(), 300);
    }, 4000);
}

function showErrorToast(message) {
    const toast = document.createElement('div');
    toast.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
        color: white;
        padding: 16px 24px;
        border-radius: 8px;
        box-shadow: 0 10px 25px rgba(239, 68, 68, 0.3);
        z-index: 9999;
        font-size: 14px;
        font-weight: 500;
        max-width: 400px;
        opacity: 0;
        transform: translateX(400px);
        transition: all 0.3s ease;
    `;
    toast.textContent = message;
    document.body.appendChild(toast);
    
    setTimeout(() => {
        toast.style.opacity = '1';
        toast.style.transform = 'translateX(0)';
    }, 10);
    
    setTimeout(() => {
        toast.style.opacity = '0';
        toast.style.transform = 'translateX(400px)';
        setTimeout(() => toast.remove(), 300);
    }, 4000);
}

// Report Modal Management
let currentReportReviewId = null;

function openReportModal(reviewId) {
    if (!reviewId) {
        showErrorToast('Error: Could not identify the review. Please refresh the page and try again.');
        console.error('openReportModal called with invalid reviewId:', reviewId);
        return;
    }
    
    currentReportReviewId = reviewId;
    const modal = document.querySelector('.report-modal-overlay');
    
    if (!modal) {
        showErrorToast('Error: Report modal not found on page.');
        console.error('Report modal overlay not found');
        return;
    }
    
    const textarea = document.querySelector('#report-reason-textarea');
    const checkboxes = document.querySelectorAll('.report-reason-checkbox');
    
    // Reset form
    if (textarea) textarea.value = '';
    checkboxes.forEach(cb => cb.checked = false);
    
    modal.classList.add('active');
    if (textarea) textarea.focus();
}

function closeReportModal() {
    const modal = document.querySelector('.report-modal-overlay');
    if (modal) {
        modal.classList.remove('active');
    }
    // Don't reset currentReportReviewId here - it might still be needed
}

function submitReport() {
    // Validate that we have a review ID
    if (!currentReportReviewId) {
        showErrorToast('Error: Review ID not found. Please try again.');
        closeReportModal();
        return;
    }
    
    // Get selected checkboxes
    const checkboxes = document.querySelectorAll('.report-reason-checkbox:checked');
    const selectedReasons = Array.from(checkboxes).map(cb => cb.value);
    const textarea = document.querySelector('#report-reason-textarea');
    const additionalDetails = textarea.value.trim();
    
    // Must select at least one reason
    if (selectedReasons.length === 0) {
        showErrorToast('Please select at least one reason for reporting this review');
        return;
    }
    
    // Build the reason string
    let reason = selectedReasons.join(', ');
    if (additionalDetails) {
        reason += ' | ' + additionalDetails;
    }
    
    // Store reviewId before closing modal (don't close yet - let submitReportToServer close it)
    const reviewId = currentReportReviewId;
    submitReportToServer(reviewId, reason);
}

// Report Review Function
async function reportReview(reviewId) {
    openReportModal(reviewId);
}

async function submitReportToServer(reviewId, reason) {
    if (!reviewId) {
        showErrorToast('Error: Review ID is missing. Please try again.');
        console.error('submitReportToServer called with invalid reviewId:', reviewId);
        closeReportModal();
        return;
    }

    try {
        const csrfTokenElement = document.querySelector('input[name="csrf_token"]');
        if (!csrfTokenElement) {
            showErrorToast('Error: CSRF token not found. Please refresh the page and try again.');
            console.error('CSRF token element not found');
            closeReportModal();
            return;
        }

        const response = await fetch(`/reviews/${reviewId}/flag`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': csrfTokenElement.value
            },
            body: JSON.stringify({ reason: reason })
        });

        const data = await response.json();

        if (response.ok) {
            showSuccessToast('üëç Thanks for letting us know! This comment has been sent to an administrator for review.');
            closeReportModal();
            
            // Update button state
            const reviewElement = document.querySelector(`[data-review-id="${reviewId}"]`);
            if (reviewElement) {
                const reportBtn = reviewElement.querySelector('.btn-flag-review');
                if (reportBtn) {
                    reportBtn.disabled = true;
                    reportBtn.textContent = '‚úì Reported';
                    reportBtn.style.opacity = '0.5';
                }
            }
        } else {
            showErrorToast(data.message || 'Failed to report review');
            closeReportModal();
        }
    } catch (error) {
        console.error('Error reporting review:', error);
        showErrorToast('An error occurred while reporting the review. Please try again.');
        closeReportModal();
    }
}

// Review flagging functionality
let currentReviewId = null;

// Old flag modal functions - replaced with direct reportReview() function above
function openFlagModal(reviewId) {
    // No longer used - reportReview() is called directly instead
}

function closeFlagModal() {
    // No longer used
}

// Old flagForm submit handler - replaced with reportReview() function
// (keeping this commented out for reference, but it's no longer needed)
/*
document.getElementById('flagForm').addEventListener('submit', async (e) => {
    e.preventDefault();
    
    const reason = document.querySelector('input[name="flag_reason"]:checked').value;
    const additionalInfo = document.getElementById('flag-additional-info').value;
    
    try {
        const response = await fetch(`/reviews/${currentReviewId}/flag`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': document.querySelector('input[name="csrf_token"]').value
            },
            body: JSON.stringify({
                reason: reason,
                additional_info: additionalInfo
            })
        });
        
        const result = await response.json();
        
        if (result.success) {
            showSuccessToast('üëç Thanks for letting us know! This comment has been sent to an administrator for review.');
            closeFlagModal();
            // Update the button to show it's flagged
            const reviewItem = document.querySelector(`[data-review-id="${currentReviewId}"]`);
            if (reviewItem) {
                reviewItem.classList.add('flagged');
                const flagBtn = reviewItem.querySelector('.btn-flag-review');
                if (flagBtn) {
                    flagBtn.classList.add('flagged');
                }
            }
        } else {
            alert('Error: ' + result.message);
        }
    } catch (error) {
        console.error('Error:', error);
        alert('Error reporting review. Please try again.');
    }
});



// Close modal when clicking outside
document.querySelector('.report-modal-overlay').addEventListener('click', (e) => {
    if (e.target.classList.contains('report-modal-overlay')) {
        closeReportModal();
    }
});

// Handle Enter key to submit
document.querySelector('#report-reason-textarea').addEventListener('keydown', (e) => {
    if (e.key === 'Enter' && e.ctrlKey) {
        submitReport();
    }
});
*/
</script>

<!-- Report Review Modal -->
<div class="report-modal-overlay" id="reportModalOverlay">
    <div class="report-modal">
        <h2>Report This Review</h2>
        <p>Help us keep our community positive. Select one or more reasons below and optionally add details.</p>
        
        <div style="margin-bottom: var(--space-lg);">
            <p style="font-weight: 600; color: #333; margin-bottom: var(--space-md); font-size: 14px;">What's wrong with this review?</p>
            
            <div style="display: flex; flex-direction: column; gap: var(--space-md);">
                <label style="display: flex; align-items: center; gap: var(--space-md); cursor: pointer; font-size: 14px;">
                    <input type="checkbox" class="report-reason-checkbox" value="inappropriate" style="cursor: pointer;">
                    <span>Inappropriate or offensive content</span>
                </label>
                
                <label style="display: flex; align-items: center; gap: var(--space-md); cursor: pointer; font-size: 14px;">
                    <input type="checkbox" class="report-reason-checkbox" value="spam" style="cursor: pointer;">
                    <span>Spam or advertisement</span>
                </label>
                
                <label style="display: flex; align-items: center; gap: var(--space-md); cursor: pointer; font-size: 14px;">
                    <input type="checkbox" class="report-reason-checkbox" value="harassment" style="cursor: pointer;">
                    <span>Harassment or bullying</span>
                </label>
                
                <label style="display: flex; align-items: center; gap: var(--space-md); cursor: pointer; font-size: 14px;">
                    <input type="checkbox" class="report-reason-checkbox" value="misinformation" style="cursor: pointer;">
                    <span>False or misleading information</span>
                </label>
                
                <label style="display: flex; align-items: center; gap: var(--space-md); cursor: pointer; font-size: 14px;">
                    <input type="checkbox" class="report-reason-checkbox" value="off_topic" style="cursor: pointer;">
                    <span>Off-topic or not a real review</span>
                </label>
            </div>
        </div>
        
        <div style="margin-bottom: var(--space-lg);">
            <p style="font-weight: 600; color: #333; margin-bottom: var(--space-md); font-size: 14px;">Additional details (optional)</p>
            <textarea id="report-reason-textarea" placeholder="Add any extra context that might help the moderation team..." maxlength="500" style="resize: vertical; min-height: 80px;"></textarea>
        </div>
        
        <div class="report-modal-actions">
            <button type="button" class="btn-cancel" onclick="closeReportModal()">Cancel</button>
            <button type="button" class="btn-submit" onclick="submitReport()">Submit Report</button>
        </div>
    </div>
</div>

{% endblock %}

